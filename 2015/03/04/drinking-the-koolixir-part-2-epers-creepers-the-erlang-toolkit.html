<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html class='no-js'>
<!-- <![endif] -->
<head></head>
<meta charset='utf-8'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<meta content='Blake Tidwell, professional web developer and aspiring EDM producer, talks bytes, beats, and philosophy.' name='description'>
<meta content='width=device-width' name='viewport'>
<meta content='summary' name='twitter:card'>
<meta content='@BATidwell' name='twitter:site'>
<meta content='Drinking The Koolixir (Part 2) - EPERs Creepers, The Erlang Toolkit!' name='twitter:title'>
<meta content='Blake Tidwell, professional web developer and aspiring EDM producer, talks bytes, beats, and philosophy.' name='twitter:description'>
<meta content='http://www.gravatar.com/avatar/b761c938fc4158ea4eed9f8283ac9fc3.png' name='twitter:image'>
<meta content='http://www.blaketidwell.com/2015/03/04/drinking-the-koolixir-part-2-epers-creepers-the-erlang-toolkit.html' name='twitter:url'>
<title>
Blake Tidwell - Drinking The Koolixir (Part 2) - EPERs Creepers, The Erlang Toolkit!
</title>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/stylesheets/app.css" rel="stylesheet" type="text/css" />
<link href='/favicon.ico?v=3' rel='shortcut icon'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
</html>
<body>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<div id='fb-root'></div>
<div class='row' id='header'>
<div class='small-12 columns'>
<div class='row'>
<div class='small-9 columns'>
<h1>
<a href="/">Blake Tidwell</a>
</h1>
<h2>Code. Create. Connect.</h2>
</div>
<div class='small-3 columns'>
<img class='avatar show-for-medium-up' src='http://www.gravatar.com/avatar/b761c938fc4158ea4eed9f8283ac9fc3.png'>
</div>
</div>
<div class='row'>
<div class='small-12 medium-offset-9 medium-3 columns'>
<ul class='social inline-list'>
<li>
<a href='http://www.linkedin.com/in/blaketidwell'>
<i class='fi-social-linkedin'></i>
</a>
</li>
<li>
<a href='https://github.com/blaketidwell'>
<i class='fi-social-github'></i>
</a>
</li>
<li>
<a href='https://twitter.com/BATidwell'>
<i class='fi-social-twitter'></i>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class='row' id='container'>
<div class='small-12 medium-8 columns' id='main' role='main'>
<article>
<h1 class='article-title'>Drinking The Koolixir (Part 2) - EPERs Creepers, The Erlang Toolkit!</h1>
<div class='row share-container'>
<div class='small-12 columns'>
<div class='share'>
<a class='twitter-share-button' data-count='none' data-hashtags='codecreateconnect' data-related='BATidwell' href='https://twitter.com/share'>
Tweet
</a>
<div class='fb-like' data-action='like' data-layout='button' data-share='true'></div>
</div>
</div>
</div>
<p>To get a better handle on Erlang&rsquo;s behavior, I decided to install a popular set
of tools for debugging and performance profiling: EPER. I <em>think</em> it stands for
&ldquo;Erlang PERformance tools&rdquo;, but it could also mean &ldquo;Everything Proves Erlang
Rules&rdquo; or &ldquo;Egrets Prefer to Eat Robots&rdquo; or really anything for that matter. One
thing is for certain, however: getting these tools built and running on Mac OS X
was fraught with <img alt="fire" src="/images/emoji/fire.png" style="vertical-align:middle;" width="20" height="20" />danger<img alt="fire" src="/images/emoji/fire.png" style="vertical-align:middle;" width="20" height="20" /> and <img alt="boom" src="/images/emoji/boom.png" style="vertical-align:middle;" width="20" height="20" /> build errors. <img alt="boom" src="/images/emoji/boom.png" style="vertical-align:middle;" width="20" height="20" />.</p>

<p></p>

<h2>Running the Test Suit</h2>

<p>Before I got down to the business of trying to <code>make</code> and <code>make install</code> EPER,
it made sense to run <code>make test</code> to ensure everything was in working order. Why
start there? I don&rsquo;t know, I guess I <img alt="heart" src="/images/emoji/heart.png" style="vertical-align:middle;" width="20" height="20" /> tests or something. Maybe I was
abandoned as a child with a tribe of poorly tested hunter-gatherers, so I HAVE
TO CONFIRM STABILITY BEFORE CODING. Who knows?! <img alt="tired_face" src="/images/emoji/tired_face.png" style="vertical-align:middle;" width="20" height="20" /> Seemed like a
decent way to figure out how the system ticks, and learn a little more about how
the pieces of the Erlang environment fit together.</p>

<h2>Problems Arise</h2>

<h3>EPMD</h3>

<p>Le duh. Right off the bat, I ran into issues with <code>eunit</code> tests not passing.
Specifically, the first run of <code>make test</code> yielded the following:</p>
<pre class="highlight shell"><code><span class="o">=</span>INFO <span class="nv">REPORT</span><span class="o">====</span> 4-Mar-2015::19:05:02 <span class="o">===</span>
Protocol: <span class="s2">"inet_tcp"</span>: register/listen error: econnrefused
prfDog: t0_test <span class="o">(</span>module <span class="s1">'prfDog'</span><span class="o">)</span>...<span class="k">*</span>failed<span class="k">*</span>
<span class="k">in function </span>prfHost:assert_proxy/1 <span class="o">(</span>src/prfHost.erl, line 67<span class="o">)</span>
<span class="k">in </span>call from prfHost:start/4 <span class="o">(</span>src/prfHost.erl, line 26<span class="o">)</span>
<span class="k">in </span>call from prfDog:t0_test/0 <span class="o">(</span>src/prfDog.erl, line 178<span class="o">)</span>
<span class="k">**</span><span class="nb">exit</span>:<span class="o">{</span>no_proxy,nonode@nohost<span class="o">}</span>
</code></pre>

<p>The solution? Start <code>epmd</code> in &ldquo;daemon&rdquo; mode:</p>
<pre class="highlight shell"><code>epmd -daemon
</code></pre>

<p>That solved the issue, but does raise some more questions. Like: What the heck
is <code>epmd</code>? How do I manage this service on a Mac? Is it <code>lunchy</code> compatible?
<code>launchd</code>? <code>initctl</code>?  CAN I JUST SHOUT AT IT. Will definitely be digging deeper
into <code>epmd</code> in a future post. For now, we march onward through Error Canyon.</p>

<h3>GTKNode</h3>

<p>The installation process next failed because <code>gperfGtk</code> claims it is missing
something:</p>
<pre class="highlight shell"><code>src/gperfGtk.erl:386: Warning: gperfGtk:g/1 calls undefined <span class="k">function </span>gtknode:cmd/2 <span class="o">(</span>Xref<span class="o">)</span>
src/gperfGtk.erl:37: Warning: gperfGtk:init/0 calls undefined <span class="k">function </span>gtknode:start/1 <span class="o">(</span>Xref<span class="o">)</span>
src/sherk.erl:567: Warning: sherk:g/1 calls undefined <span class="k">function </span>gtknode:cmd/2 <span class="o">(</span>Xref<span class="o">)</span>
src/sherk.erl:56: Warning: sherk:init/0 calls undefined <span class="k">function </span>gtknode:start/1 <span class="o">(</span>Xref<span class="o">)</span>
ERROR: xref failed <span class="k">while </span>processing /Users/BTidwellGrio/Code/elx_workspace/eper: rebar_abort
make: <span class="k">***</span> <span class="o">[</span>xref] Error 1
</code></pre>

<p>A little Garggling turned up the fact that <code>gtknode</code> is an OSS Erlang library
for mapping to the popular UI library, GTK. I pulled down <a href="https://github.com/massemanet/gtknode">the
repo</a>, and after a little more digging,
found the command for building and installing it:</p>
<pre class="highlight plaintext"><code>aclocal ; autoconf ; automake ; ./configure --prefix=/your/cool/prefix ; make ; make install
</code></pre>

<p>For the prefix here, I personally like to keep all of my shell/library Erlang in
a <code>.erllib</code> folder in my home directory. I track a couple of helper files in the
same folder in a dotfiles repo, and ignore the build output of all the remaining
libraries.</p>

<p>The first run of the <code>gtknode</code> build exited with:</p>
<pre class="highlight plaintext"><code>Checking for GTK... no
configure: error: Package requirements (gmodule-2.0 libglade-2.0 gtk+-2.0,
gdk-pixbuf-2.0) were not met:

Package 'libxml-2.0', required by 'libglade-2.0', not found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.
</code></pre>

<p>This story checks out; one can fairly safely assume that a library named
<code>gtkWHATEVER</code> will, in fact, need some other thing called <code>GTK</code>. The <code>README</code>
for <code>gtknode</code> encourages the use of Homebrew to install <code>glade</code> (amongst myriad
other things). This first required adding the X11 homebrew tap. Additionally, a
couple more runs of the build script revealed a dependency on XQuart, which is
easily managed using Homebrew Cask. As I had never used Cask up to this point, I
have included it in the installation steps below:</p>
<pre class="highlight plaintext"><code>brew tap homebrew/x11
brew install glade fontconfig freetype libpng
brew install caskroom/cask/brew-cask
brew cask doctor # This triggers a sudo prompt to configure needed directories
brew cask install xquartz
</code></pre>

<p>Since we installed <code>glade</code> and some of the other libraries using Homebrew,
running another build will result in <code>&quot;Package &#39;xcb-shm&#39;, required by &#39;cairo&#39;,
not found&quot;</code> (or any number of other <code>&quot;[Package] not found&quot;</code> errors). I am not
completely familiar with <code>pkg-config</code>, but it seems the gist of the problem is
that Homebrew installs binaries and libraries in non-default locations (at least
from a Linux perspective). This can be fixed by exporting the <code>pkgconfig</code>
environment variable*:</p>
<pre class="highlight plaintext"><code>PKG_CONFIG_PATH=/usr/local/opt/libxml2/lib/pkgconfig:/usr/local/lib/pkgconfig:/opt/X11/lib/pkgconfig
</code></pre>

<p>*<em>This lovely bit of minutiae comes courtesy of a completely unrelated page in
the <a href="https://github.com/Automattic/node-canvas/wiki/Installation---OSX">node-canvas Wiki</a>.</em></p>

<p>With all this in place, <code>gtknode</code> should compile, and <code>make test</code> from the
<code>eper</code> project root should pass. Then, the EPER project can be built using the
same tune as <code>gtknode</code>:</p>
<pre class="highlight plaintext"><code>aclocal ; autoconf ; automake ; ./configure --prefix=/your/cool/prefix ; make ; make install
</code></pre>

<h2>Then What?</h2>

<p>Now that these libraries are compiled and installed using the prefix we provided
earlier, we can add them to the Erlang shell using the <code>ERL_LIBS</code> environment
variable. If you used the same convention stated here (i.e. <code>.erllib</code> in the
home directory), then this variable should look like the following:</p>
<pre class="highlight plaintext"><code>export ERL_LIBS="$HOME/.erllib/lib/erlang/lib"
</code></pre>

<p>On startup, the Erlang shell will load any source code in the <code>ebin</code> directory
of any libraries contained under the <code>ERL_LIBS</code> directory. If you refresh this
environment variable and then run <code>erl</code> from the command-line, you should be
able to sanity-check installation of EPER by running <code>redbug:help().</code> inside the
Erlang shell. This should output a list of methods supported by Redbug.</p>

<p>With this in place, I feel like I can move forward with learning Erlang in a
much more disciplined way. Now, when something goes wrong deep in the depths of
some wacky Erlang function, I can do some code spelunking courtesy of <code>redbug</code>
instead of being all like, &ldquo;Hey Erlang, WHAT UP IN THERE YO like maybe you
could JUST START WORKING NOW.&rdquo; I may follow-up with a dedicated post
on redbug or just interweave it with future blog posts, but either way you can
expect to see more about proper <code>redbug</code> usage here on my blarg.</p>

<div class='row'>
<div class='small-12 columns'>
<div class='share'>
<a class='twitter-share-button' data-count='none' data-hashtags='codecreateconnect' data-related='BATidwell' href='https://twitter.com/share'>
Tweet
</a>
<div class='fb-like' data-action='like' data-layout='button' data-share='true'></div>
</div>
</div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_title = 'Drinking The Koolixir (Part 2) - EPERs Creepers, The Erlang Toolkit!'
                                var disqus_shortname = 'blaketidwell';
                                          var disqus_identifier = '/2015/03/04/epers-creepers-bugs-and-boogiemonsters-in-the-erlang-toolchain.html';
          var disqus_url = 'http://www.blaketidwell.com/2015/03/04/epers-creepers-bugs-and-boogiemonsters-in-the-erlang-toolchain.html';
                  
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
//<![CDATA[
    var disqus_shortname = 'blaketidwell';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script>

</article>

</div>
<aside class='medium-4 columns show-for-medium-up' id='filters'>
<h3>Recent Articles</h3>
<ul>
<li>
<a href="/2015/08/16/keeping-your-app-from-flying-off-of-the-rails-with-bdd-part-1.html">Keeping Your App from Flying Off of the Rails with BDD - Part 1 of Question Mark</a>
<span>Aug&nbsp;16</span>
</li>
<li>
<a href="/2015/03/04/drinking-the-koolixir-part-2-epers-creepers-the-erlang-toolkit.html">Drinking The Koolixir (Part 2) - EPERs Creepers, The Erlang Toolkit!</a>
<span>Mar&nbsp; 4</span>
</li>
<li>
<a href="/2015/02/07/drinking-the-koolixir.html">Drinking The Koolixir (Part 1)</a>
<span>Feb&nbsp; 7</span>
</li>
<li>
<a href="/2015/01/27/ember-rails-csrf-handling.html">Ember Rails CSRF Handling</a>
<span>Jan&nbsp;27</span>
</li>
<li>
<a href="/2014/11/24/leds-and-303s-static-page-on-divshot.html">LEDs and 303s Static Page on Divshot</a>
<span>Nov&nbsp;24</span>
</li>
<li>
<a href="/2014/03/23/starting-from-the-middleman.html">Starting From the Middle(Man)</a>
<span>Mar&nbsp;23</span>
</li>
</ul>
<h3>Tags</h3>
<ul>
<li><a href="/tags/technical.html">technical (6)</a></li>
<li><a href="/tags/ruby.html">ruby (4)</a></li>
<li><a href="/tags/blog.html">blog (1)</a></li>
<li><a href="/tags/how-to.html">how-to (2)</a></li>
<li><a href="/tags/deployment.html">deployment (1)</a></li>
<li><a href="/tags/emberjs.html">emberjs (1)</a></li>
<li><a href="/tags/rails.html">rails (2)</a></li>
<li><a href="/tags/quickread.html">quickread (1)</a></li>
<li><a href="/tags/dragons.html">dragons (1)</a></li>
<li><a href="/tags/functional.html">functional (2)</a></li>
<li><a href="/tags/languages.html">languages (2)</a></li>
<li><a href="/tags/erlang.html">erlang (2)</a></li>
<li><a href="/tags/elixir.html">elixir (2)</a></li>
</ul>
<h3>By Year</h3>
<ul>
<li><a href="/2015.html">2015 (4)</a></li>
<li><a href="/2014.html">2014 (2)</a></li>
</ul>
</aside>
</div>
<div id='footer'>
<div class='row'>
<div class='small-12 medium-4 columns'>
<h3>Recent Articles</h3>
<ul>
<li>
<a href="/2015/08/16/keeping-your-app-from-flying-off-of-the-rails-with-bdd-part-1.html">Keeping Your App from Flying Off of the Rails with BDD - Part 1 of Question Mark</a>
<span>Aug&nbsp;16</span>
</li>
<li>
<a href="/2015/03/04/drinking-the-koolixir-part-2-epers-creepers-the-erlang-toolkit.html">Drinking The Koolixir (Part 2) - EPERs Creepers, The Erlang Toolkit!</a>
<span>Mar&nbsp; 4</span>
</li>
<li>
<a href="/2015/02/07/drinking-the-koolixir.html">Drinking The Koolixir (Part 1)</a>
<span>Feb&nbsp; 7</span>
</li>
<li>
<a href="/2015/01/27/ember-rails-csrf-handling.html">Ember Rails CSRF Handling</a>
<span>Jan&nbsp;27</span>
</li>
<li>
<a href="/2014/11/24/leds-and-303s-static-page-on-divshot.html">LEDs and 303s Static Page on Divshot</a>
<span>Nov&nbsp;24</span>
</li>
<li>
<a href="/2014/03/23/starting-from-the-middleman.html">Starting From the Middle(Man)</a>
<span>Mar&nbsp;23</span>
</li>
</ul>
</div>
<div class='small-12 medium-4 columns'>
<h3>Tags</h3>
<div class='row'>
<div class='small-12 medium-6 columns'>
<ul class='tag-group'>
<li><a href="/tags/technical.html">technical (6)</a></li>
<li><a href="/tags/ruby.html">ruby (4)</a></li>
<li><a href="/tags/blog.html">blog (1)</a></li>
<li><a href="/tags/how-to.html">how-to (2)</a></li>
<li><a href="/tags/deployment.html">deployment (1)</a></li>
<li><a href="/tags/emberjs.html">emberjs (1)</a></li>
</ul>
</div>
<div class='small-12 medium-6 columns'>
<ul class='tag-group last'>
<li><a href="/tags/rails.html">rails (2)</a></li>
<li><a href="/tags/quickread.html">quickread (1)</a></li>
<li><a href="/tags/dragons.html">dragons (1)</a></li>
<li><a href="/tags/functional.html">functional (2)</a></li>
<li><a href="/tags/languages.html">languages (2)</a></li>
<li><a href="/tags/erlang.html">erlang (2)</a></li>
</ul>
</div>
</div>
</div>
<div class='small-12 medium-4 columns'>
<h3>By Year</h3>
<ul>
<li><a href="/2015.html">2015 (4)</a></li>
<li><a href="/2014.html">2014 (2)</a></li>
</ul>
</div>
</div>
</div>
<script src="/javascripts/app.js" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-22797683-1', 'blaketidwell.com');
  ga('send', 'pageview');
</script>
</body>
